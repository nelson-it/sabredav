#!/bin/bash

BASEDIR=www
DAVDIR=erp_dav
PUSHDIR=erp_push

rm -rf $BASEDIR/$DAVDIR
rm -rf $BASEDIR/$PUSHDIR

mkdir -p $BASEDIR/$DAVDIR
mkdir -p $BASEDIR/$PUSHDIR

echo 'copy mnesabre'
tar -cf - mnesabre composer.json composer.phar remote.php | ( cd $BASEDIR/$DAVDIR; tar -xf - )

( cd $BASEDIR/$DAVDIR;  chmod +x composer.phar; ./composer.phar install )

( cd $BASEDIR/$PUSHDIR;  git clone https://github.com/fmbiete/Z-Push-contrib.git .; )

for file in `cd mnepush; find . -type f`
do
    echo $file
    if [ -f $BASEDIR/$PUSHDIR/$file ]; then
        mv $BASEDIR/$PUSHDIR/$file $BASEDIR/$PUSHDIR/$file.orig
    fi
done

echo 'copy mnepush'
( cd mnepush; tar -cf - . ) | ( cd $BASEDIR/$PUSHDIR; tar -xf - )
 
chown -R www-data:manny $BASEDIR
chmod -R g+w $BASEDIR

